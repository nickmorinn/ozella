{% comment %}
    Renders shipping bar
    Accepts:
    - class {String} Additional classes
    Usage:
    {%- render 'shipping-bar', class: 'additional_classes' -%}
{% endcomment %}

{%- liquid
  assign threshold = settings.shipping_notification_threshold | times: 100
  assign threshold_percentage = cart.total_price | times: 100.0 | divided_by: threshold

  if threshold_percentage < 0
    assign threshold_percentage = 0
  elsif threshold_percentage > 100
    assign threshold_percentage = 100
  endif
-%}



{%- style -%}
  {%- if cart == empty -%}
    .shipping-bar {
      visibility: hidden;
    }
  {%- endif -%}
{%- endstyle -%}

{%- if settings.enable_shipping_notification and threshold > 0 -%}
  <shipping-bar
    data-cart-total="{{ cart.total_price }}"
    data-shipping-threshold="{{ threshold }}"
    data-progress="calc({{ threshold_percentage }}% + 2px)"
    class="shipping-bar progress-bar {{ class }}"
  >
    <div class="progress-bar__top">
      {%- render 'icon', icon_name: 'theme-box-success' -%}
      <p class="progress-bar__text">
        {% comment %}{%- liquid
          if cart.total_price >= threshold
            echo 'cart.free_shipping_text_success' | t
          else
            assign remaining_amount = threshold | minus: cart.total_price
            assign remaining_amount_money = remaining_amount | money
            if settings.show_currency_codes
              assign remaining_amount_money = remaining_amount | money_with_currency
            endif
            echo 'cart.free_shipping_text_html' | t: amount: remaining_amount_money
          endif
        -%}{% endcomment %}
      </p>
    </div>
    <div class="progress-bar__progress">
      <span data-progress-line class="progress-bar__progress-inner" style="width: 0%"></span>
    </div>
  </shipping-bar>
{%- endif -%}
