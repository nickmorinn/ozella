{%- if settings.cart_type == 'drawer' -%}
  {%- assign free_shipping_threshold_cents = 10000 -%}
  {%- assign free_shipping_remaining = free_shipping_threshold_cents | minus: cart.total_price -%}
  {%- if free_shipping_remaining < 0 -%}
    {%- assign free_shipping_remaining = 0 -%}
  {%- endif -%}
  {%- assign free_shipping_progress = cart.total_price | times: 100 | divided_by: free_shipping_threshold_cents -%}
  {%- if free_shipping_progress > 100 -%}
    {%- assign free_shipping_progress = 100 -%}
  {%- endif -%}

  <div id="CartDrawer" class="drawer drawer--right">
    <form id="CartDrawerForm" action="{{ routes.cart_url }}" method="post" novalidate class="drawer__contents" data-location="cart-drawer">
      <div class="drawer__fixed-header">
        <div class="drawer__header appear-animation appear-delay-1">
          <div class="h2 drawer__title">{{ 'cart.general.title' | t }}</div>
          <div class="drawer__close">
            <button type="button" class="drawer__close-button js-drawer-close">
              <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-close" viewBox="0 0 64 64"><title>icon-X</title><path d="m19 17.61 27.12 27.13m0-27.12L19 44.74"/></svg>
              <span class="icon__fallback-text">{{ 'cart.general.close_cart' | t }}</span>
            </button>
          </div>
        </div>

        <div
          class="cart-drawer__shipping-bar appear-animation appear-delay-2"
          data-free-shipping-bar
          data-free-shipping-threshold="{{ free_shipping_threshold_cents }}"
        >
          <p class="cart-drawer__shipping-message">
            <span class="cart-drawer__shipping-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18" role="presentation">
                <path d="M3 7h11v8H3zM14 10h4.7a1 1 0 0 1 .7.3l2.3 2.3c.2.2.3.4.3.7V15h-3.4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="7" cy="17" r="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="17" cy="17" r="2" fill="none" stroke="currentColor" stroke-width="1.5"/>
              </svg>
            </span>
            <span data-free-shipping-message-text>
              {%- if free_shipping_remaining > 0 -%}
                Add {{ free_shipping_remaining | money_without_trailing_zeros }} more to unlock free shipping
              {%- else -%}
                You unlocked free shipping!
              {%- endif -%}
            </span>
          </p>
          <div class="cart-drawer__shipping-track" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="{{ free_shipping_progress }}">
            <span class="cart-drawer__shipping-fill" data-free-shipping-fill style="width: {{ free_shipping_progress }}%;"></span>
          </div>
        </div>
      </div>

      <div class="drawer__inner">
        <div class="drawer__scrollable">
          <div data-products class="appear-animation appear-delay-2"></div>

          {% if settings.cart_notes_enable %}
            <div class="appear-animation appear-delay-3">
              <label for="CartNoteDrawer">{{ 'cart.general.note' | t }}</label>
              <textarea name="note" class="input-full cart-notes" id="CartNoteDrawer">{{ cart.note }}</textarea>
            </div>
          {% endif %}
        </div>

        <div class="drawer__footer appear-animation appear-delay-4">
          <div data-discounts>
            {% if cart.cart_level_discount_applications != blank %}
              <div class="cart__discounts cart__item-sub cart__item-row">
                <div>{{ 'cart.general.discounts' | t }}</div>
                <div class="text-right">
                  {% for cart_discount in cart.cart_level_discount_applications %}
                    <div class="cart__discount">
                      {{ cart_discount.title }} (-{{ cart_discount.total_allocated_amount | money }})
                    </div>
                  {% endfor %}
                </div>
              </div>
            {% endif %}
          </div>

          <div class="cart__item-sub cart__item-row">
            <div class="ajaxcart__subtotal">{{ 'cart.general.subtotal' | t }}</div>
            <div data-subtotal>{{ cart.total_price | money }}</div>
          </div>

          {% if settings.cart_terms_conditions_enable %}
            <div class="cart__item-row cart__terms">
              <input type="checkbox" id="CartTermsDrawer" class="cart__terms-checkbox">
              <label for="CartTermsDrawer">
                {% if settings.cart_terms_conditions_page != blank %}
                  {{ 'cart.general.terms_html' | t: url: settings.cart_terms_conditions_page.url }}
                {% else %}
                  {{ 'cart.general.terms' | t }}
                {% endif %}
              </label>
            </div>
          {% endif %}

          <div class="cart__checkout-wrapper">
            <button type="submit" name="checkout" data-terms-required="{{ settings.cart_terms_conditions_enable }}" class="btn cart__checkout">
              <svg aria-hidden="true" focusable="false" role="presentation" class="icon icon-lock cart__checkout-icon" viewBox="0 0 64 64"><path d="M19.45 23.6v-3.2c0-7 5.89-11.75 12.55-11.75 7.21 0 12.55 5.49 12.55 11.75v3.2M10 23.6h44v31.75H10zm22 13.87v7.47"/><circle cx="32" cy="35.87" r="1.6"/></svg>
              <span>SECURE CHECKOUT</span>
            </button>

            {% if additional_checkout_buttons and settings.cart_additional_buttons %}
              <div class="additional-checkout-buttons additional-checkout-buttons--vertical">{{ content_for_additional_checkout_buttons }}</div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="drawer__cart-empty appear-animation appear-delay-2">
        <div class="drawer__scrollable">
          {{ 'cart.general.empty' | t }}
        </div>
      </div>
    </form>
  </div>
{%- endif -%}
